
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Форма добавления пациента</title>
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
  <style>
    body { font-family: sans-serif; margin: 20px; }
    /* Оверлей */
    #loginOverlay {
      position: fixed; top:0; left:0; right:0; bottom:0;
      background: rgba(0,0,0,0.7);
      display: flex; align-items: center; justify-content: center;
      z-index: 1000;
    }
    #loginBox {
      background: #fff; padding: 20px; border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.5);
      width: 90%; max-width: 320px;
    }
    #loginBox h2 { margin:0 0 10px; font-size:1.2em; }
    #loginBox input {
      width:100%; padding:8px; font-size:1em; margin-bottom:10px;
      box-sizing: border-box;
    }
    #loginBox button {
      width:100%; padding:8px; font-size:1em;
      background:#3498db; color:#fff; border:none; border-radius:4px;
    }
    /* Скрываем содержимое до входа */
    #mainContent { display: none; padding:20px; }
    /* Стили формы */
    label { display: block; margin-top: 10px; }
    input, button, select { margin-top: 5px; }
    table { margin-top: 20px; border-collapse: collapse; width: 100%; }
    td, th { border: 1px solid #ccc; padding: 5px; text-align: center; }
    #editor-container { height: 150px; background: white; }
    .saved { color: green; font-size: 14px; margin-left: 10px; }
    input[type=number] { width: 50px; }
  </style>
</head>
<body>
  <div id="loginOverlay">
    <div id="loginBox">
      <h2>Введите пароль</h2>
      <input type="password" id="loginPassword" placeholder="Пароль" />
      <button id="loginBtn">Войти</button>
    </div>
  </div>
  <!-- Основное содержимое скрыто до входа -->
  <div id="mainContent">
  <h2>Добавить пациента</h2>
  <form id="studentForm">
    <label>№ Опер.блока: <input type="text" id="firstName" required /></label>
    <label>ФИО Пациента: <input type="text" id="lastName" required /></label>
    <label>Врач: <input type="text" id="classNumber" required /></label>
    <label>Комментарий: <input type="text" id="comment" /></label>
    <label>Статус:
      <label><input type="radio" name="status" value="active" checked /> Идёт операция</label>
      <label><input type="radio" name="status" value="done" /> Операция закончилась</label>
      <label><input type="radio" name="status" value="preparation" /> Идёт подготовка</label>
      <label><input type="radio" name="status" value="planned" /> Планируется операция</label>
    </label>
    <label><input type="checkbox" id="visibleOnDisplay" checked /> Отображать в display</label>
    <button type="submit">Добавить</button>
  </form>
<table>
    <thead>
      <tr>
        <th>№ опер.блока</th><th>ФИО пациента</th><th>Врач</th><th>Комментарий</th><th>Показывать</th><th>Статус</th><th>Действия</th>
      </tr>
    </thead>
    <tbody id="studentsTable"></tbody>
  </table>
  <hr>
  </div>



  <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, updateDoc, deleteDoc, doc, serverTimestamp, setDoc } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js";

       // === ПАРОЛЬ ===
    const PASSWORD = "Ghbdtn";  // <-- поменяйте на свой
    document.getElementById("loginBtn").onclick = () => {
      const val = document.getElementById("loginPassword").value;
      if (val === PASSWORD) {
        document.getElementById("loginOverlay").style.display = "none";
        document.getElementById("mainContent").style.display = "block";
      } else {
        alert("Неверный пароль");
      }
    };

    // === Инициализация Quill ===
    const quill = new Quill('#editor-container', {
      theme: 'snow',
      modules: {
        toolbar: [
          ['bold','italic','underline','strike'],
          [{ 'color': [] },{ 'background': [] }],
          [{ 'header': 1 },{ 'header': 2 }],
          [{ 'list': 'ordered' },{ 'list': 'bullet' }],
          ['clean']
        ]
      }
    });

    // === Firebase ===
    const app = initializeApp({
      apiKey: "AIzaSyCF5BOseh3j9qi3SGAJVciuI-ZJIv6l14o",
      authDomain: "oper-timers.firebaseapp.com",
      projectId: "oper-timers",
    });
    const db = getFirestore(app);


    const form = document.getElementById("studentForm");
    const tableBody = document.getElementById("studentsTable");
    const warningForm = document.getElementById("warningForm");
 // Добавление
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const firstName = document.getElementById("firstName").value.trim();
      const lastName = document.getElementById("lastName").value.trim();
      const classNumber = document.getElementById("classNumber").value.trim();
      const comment = document.getElementById("comment").value.trim();
      const visible = document.getElementById("visibleOnDisplay").checked;
      const status = form.querySelector('input[name="status"]:checked').value;

      await addDoc(collection(db, "students"), {
        firstName, lastName, classNumber, comment, visible, status,
        duration: 0,
        startTime: serverTimestamp()
      });

      form.reset();
    });

    
// Отображение списка
    onSnapshot(collection(db, "students"), (snapshot) => {
      tableBody.innerHTML = "";
      snapshot.forEach(docSnap => {
        const d = docSnap.data();
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td><input value="${d.firstName || ''}"/></td>
          <td><input value="${d.lastName || ''}"/></td>
          <td><input value="${d.classNumber || ''}"/></td>
          <td><input value="${d.comment || ''}"/></td>
          <td><input type="checkbox" ${d.visible ? "checked" : ""} /></td>
          <td>
            <select>
              <option value="active" ${d.status === "active" ? "selected" : ""}>Идёт операция</option>
              <option value="done" ${d.status === "done" ? "selected" : ""}>Операция закончилась</option>
              <option value="preparation" ${d.status === "preparation" ? "selected" : ""}>Идёт подготовка</option>
              <option value="planned" ${d.status === "planned" ? "selected" : ""}>Планируется операция</option>
            </select>
          </td>
          <td>
            <button class="save">Сохранить</button>
            <button class="delete">Удалить</button>
          </td>
        `;
        const inputs = tr.querySelectorAll("input");
        const select = tr.querySelector("select");
 // Сохранение изменений
        tr.querySelector(".save").onclick = async () => {
          await updateDoc(doc(db, "students", docSnap.id), {
            firstName: inputs[0].value,
            lastName: inputs[1].value,
            classNumber: inputs[2].value,
            comment: inputs[3].value,
            visible: inputs[4].checked,
            status: select.value
          });
        };
 // Подтверждение и удаление
         tr.querySelector(".delete").onclick = async () => {
          if (!confirm("Вы уверены, что хотите удалить этого ученика?")) return;
          await deleteDoc(doc(db, "students", docSnap.id)); 
        };

        tableBody.appendChild(tr);
      });
    });
  </script>
</body>
</html>
